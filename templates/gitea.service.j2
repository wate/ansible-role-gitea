[Unit]
Description=Gitea (Git with a cup of tea)
After=syslog.target
After=network.target
{% if hedgedoc_cfg[hedgedoc_mode]['db']['host'] | default('localhost') in ['localhost', '127.0.0.1'] -%}
{% if hedgedoc_cfg[hedgedoc_mode]['db']['dialect'] == 'mariadb' -%}
After=mariadb.service
{% elif hedgedoc_cfg[hedgedoc_mode]['db']['dialect'] == 'mysql' -%}
After=mysql.service
{% elif hedgedoc_cfg[hedgedoc_mode]['db']['dialect'] == 'postgres' -%}
After=postgresql.service
{% endif %}
{% endif %}

[Service]
Type=simple
User={{ gitea_user}}
Group={{ gitea_user}}
WorkingDirectory={{ gitea_work_dir}}/
Environment=USER={{ gitea_user}}
Environment=HOME=/home/{{ gitea_user}}
Environment=GITEA_WORK_DIR={{ gitea_work_dir}}
ExecStart={{ gitea_install_dir }}/gitea web --config {{ gitea_config_dir }}/app.ini
Restart=always
RestartSec=2s
{{ gitea_service_extra_cfg }}

[Install]
WantedBy=multi-user.target
